<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Alaska Earthquake Map</title>
    <!-- Secure HTTPS Leaflet Links -->
    <link rel="stylesheet" href="https://unpkg.com" />
    <script src="https://unpkg.com"></script>
    
    <!-- Secure HTTPS PapaParse Link -->
    <script src="https://cdnjs.cloudflare.com"></script>

    <style>
        body { margin:0; padding:0; }
        #mapdiv { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>

<div id="mapdiv"></div>

<script>
    // Initialize map centered on Alaska
    var mymap = L.map('mapdiv').setView([64.0, -150.0], 4);

    // FIXED: Using HTTPS for the tile layer to satisfy GitHub security
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: 'Map data &copy; <a href="https://openstreetmap.org">OpenStreetMap</a>'
    }).addTo(mymap);

    function loadCSV() {
        // Ensure this filename matches your GitHub file EXACTLY
        Papa.parse("Alaska Earthquakes to Print.csv", {
            download: true,
            header: true,
            dynamicTyping: true,
            complete: function(results) {
                results.data.forEach(function(row) {
                    // Only draw if latitude and longitude are valid numbers
                    if (typeof row.latitude === 'number' && typeof row.longitude === 'number') {
                        L.circle([row.latitude, row.longitude], {
                            radius: (row.depth || 1) * 500, // Multiplier to make depth visible
                            color: 'red',
                            fillColor: '#f03',
                            fillOpacity: 0.5
                        })
                        .bindPopup(`<b>Location:</b> ${row.place}<br>
                                    <b>Magnitude:</b> ${row.magnitude}<br>
                                    <b>Depth:</b> ${row.depth} km`)
                        .addTo(mymap);
                    }
                });
            }
        });
    }

    loadCSV();
</script>
</body>
</html>