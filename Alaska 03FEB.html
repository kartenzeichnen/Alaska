<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Alaska Earthquake Map</title>
    <!-- Use the most 'trusted' CDN on the web (Cloudflare) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com" />
    <style>
        html, body, #mapdiv { height: 100%; width: 100%; margin: 0; padding: 0; background: #eee; }
    </style>
</head>
<body>
    <div id="mapdiv"></div>

    <!-- Load Scripts from Cloudflare -->
    <script src="https://cdnjs.cloudflare.com"></script>
    <script src="https://cdnjs.cloudflare.com"></script>

    <script>
        // Use a function to wait until libraries exist
        function init() {
            if (typeof L === 'undefined' || typeof Papa === 'undefined') {
                console.log("Retrying in 500ms...");
                setTimeout(init, 500);
                return;
            }

            var mymap = L.map('mapdiv').setView([64.0, -150.0], 4);
            
            // Standard Tile Layer
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(mymap);

            Papa.parse("Alaska Earthquakes to Print.csv", {
                download: true,
                header: true,
                dynamicTyping: true,
                complete: function(results) {
                    results.data.forEach(function(row) {
                        if (row.latitude && row.longitude) {
                            L.circle([row.latitude, row.longitude], {
                                radius: (row.depth || 1) * 500,
                                color: 'red',
                                fillOpacity: 0.5
                            }).addTo(mymap);
                        }
                    });
                }
            });
        }
        init();
    </script>
</body>
</html>