<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Alaska Earthquake Map</title>
    <!-- We use the standard links, but I've added a 'crossorigin' attribute to help GitHub/CORB -->
    <link rel="stylesheet" href="https://unpkg.com" crossorigin=""/>
    <script src="https://unpkg.com" crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com" crossorigin=""></script>

    <style>
        html, body { height: 100%; margin: 0; }
        #mapdiv { height: 100vh; width: 100%; background: #e0e0e0; }
    </style>
</head>
<body>

<div id="mapdiv"></div>

<script>
    // 1. Initialize Map
    var mymap = L.map('mapdiv').setView([64.0, -150.0], 4);

    // 2. Add Tiles (HTTPS is mandatory for GitHub)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap'
    }).addTo(mymap);

    // 3. Load CSV - We use a relative path to avoid CORB blocks
    function loadData() {
        Papa.parse("Alaska Earthquakes to Print.csv", {
            download: true,
            header: true,
            dynamicTyping: true,
            skipEmptyLines: true,
            complete: function(results) {
                console.log("Rows parsed: ", results.data.length);
                
                results.data.forEach(function(row) {
                    // Match these names EXACTLY to your CSV headers
                    var lat = row.latitude;
                    var lon = row.longitude;
                    var depth = row.depth;
                    var place = row.place || "Unknown Location";

                    if (lat && lon) {
                        // Create circle: radius is depth * 500 meters
                        L.circle([lat, lon], {
                            radius: (depth || 1) * 500,
                            color: 'red',
                            fillColor: '#f03',
                            fillOpacity: 0.5
                        })
                        .bindPopup(`<b>${place}</b><br>Depth: ${depth} km`)
                        .addTo(mymap);
                    }
                });
            },
            error: function(err) {
                console.error("CSV Load Error:", err);
            }
        });
    }

    // Delay start slightly to ensure libraries are ready
    setTimeout(loadData, 500);
</script>
</body>
</html>
